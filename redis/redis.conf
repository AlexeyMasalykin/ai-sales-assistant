# Redis конфигурация для production
# Защита от внешних атак

# ============================================================================
# БЕЗОПАСНОСТЬ
# ============================================================================

# ПРИМЕЧАНИЕ: Пароль устанавливается через docker-compose (--requirepass)
# чтобы использовать переменные окружения

# Привязка только к localhost (внутри Docker сети)
bind 0.0.0.0
protected-mode yes

# ============================================================================
# ОТКЛЮЧЕНИЕ ОПАСНЫХ КОМАНД
# ============================================================================

# Отключаем команды репликации (защита от SLAVEOF атак)
rename-command SLAVEOF ""
rename-command REPLICAOF ""

# Отключаем изменение конфигурации
rename-command CONFIG ""

# Отключаем остановку сервера
rename-command SHUTDOWN ""

# Отключаем сброс данных
rename-command FLUSHDB ""
rename-command FLUSHALL ""

# Отключаем DEBUG команды
rename-command DEBUG ""

# ============================================================================
# ПЕРСИСТЕНТНОСТЬ
# ============================================================================

# AOF для сохранения данных
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec

# Снапшоты
save 900 1
save 300 10
save 60 10000

# ============================================================================
# ЛИМИТЫ
# ============================================================================

# Максимум памяти (512MB)
maxmemory 512mb
maxmemory-policy allkeys-lru

# Максимум клиентов
maxclients 100

# Timeout неактивных соединений (5 минут)
timeout 300

# ============================================================================
# ЛОГИРОВАНИЕ
# ============================================================================

loglevel notice

