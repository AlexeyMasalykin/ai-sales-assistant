# План реализации проекта «Интеллектуальный ассистент продаж ИИ-услуг»

## 1. Общая стратегия
- **Подход**: поэтапная реализация с регулярными контрольными точками, приоритет на критические интеграции и автоматизацию процессов продаж.
- **Методология**: Kanban с двухнедельными фокус-итерациями, демонстрация прогресса в конце каждой итерации.
- **Команда**: backend-разработчики, ML/LLM-инженер, DevOps, тестировщик, аналитик, специалист по интеграциям, менеджер проекта.

## 2. Этапы и сроки
| Этап | Содержание | Длительность | Критерии завершения |
|------|------------|--------------|---------------------|
| 1. Старт проекта | Подготовка инфраструктуры, CI/CD, настройка окружений, сбор исходных данных для RAG | 1 неделя | Репозиторий и пайплайн готовы, окружения развёрнуты, база знаний собрана |
| 2. Базовая платформа | Реализация FastAPI приложения, модели данных, JWT авторизация, логирование, rate limiting | 2 недели | Рабочий API, безопасность, health-check, покрытие unit-тестами ≥30% |
| 3. RAG и LLM | Интеграция OpenAI (диалоги + эмбеддинги), pgvector, базовые сценарии общения | 2 недели | Поиск по базе знаний, устойчивый диалог, тестовое покрытие RAG и LLM слоёв |
| 4. Интеграция Avito | OAuth, webhooks, автоответы, обновление объявлений, передача лидов в CRM | 2 недели | Успешные интеграционные тесты Avito, лиды отмечаются тегом `avito-lead` |
| 5. Telegram и сайт | Telegram webhook, чат-виджет, онлайн-калькулятор, синхронизация с Redis | 2 недели | Тестовые сценарии в Telegram и на сайте проходят, контекст сохраняется 30 дней |
| 6. Документы и расчёт | Реализация формулы стоимости, генерация PDF (КП, договор, счёт), проверка лимитов | 1,5 недели | PDF < 10 МБ, формула применима ко всем пакетам, покрытие тестами расчётов |
| 7. Интеграции CRM/Calendar/ЮKassa | amoCRM, Google Calendar, ЮKassa, Email уведомления | 2 недели | Лиды создаются, слоты бронируются, платежи и уведомления проходят успешно |
| 8. Оптимизация и безопасность | Шифрование данных, мониторинг, резервирование, нагрузочные тесты | 1,5 недели | AES-256 внедрён, Sentry, Prometheus, результаты нагрузочного теста удовлетворяют KPI |
| 9. Финализация | Документация, обучение команды, план инцидентов, подготовка релиза | 1 неделя | Документы обновлены, команда обучена, релизный чек-лист согласован |

Суммарная длительность: ~13 недель (с возможностью параллелизации отдельных задач).

## 3. Бэклог задач по блокам
### 3.1 Инфраструктура и DevOps
- Настроить Dockerfile, docker-compose, окружения `.env`.
- Подготовить GitHub Actions/GitLab CI для проверки кода и тестов.
- Настроить развёртывание на Hetzner, подготовить Nginx + Certbot.
- Реализовать резервное копирование (`rsync`, `pg_dump`, снапшоты Redis).

### 3.2 Backend и API
- Базовые FastAPI роутеры, схемы Pydantic, middleware JWT.
- Реализация rate limiting (fastapi-limiter + Redis).
- Обработчики health-check `/health`, `/ready`.
- Выделенные роутеры для Avito, Telegram, admin, webhooks.

### 3.3 RAG и LLM
- Парсинг базы знаний, нормализация контента, векторизация.
- Создание пайплайна обновления индексов.
- Разработка промптов, fallback-политики между GPT-4o-mini и Claude 3.5.
- Логика сохранения и восстановления контекста диалогов.

### 3.4 Расчёт и документы
- Структура прайс-листов, конфигурации коэффициентов.
- Сервис расчёта стоимости с валидаторами.
- Шаблоны Jinja2 и генерация PDF через WeasyPrint.
- Хранение и доступ к сгенерированным документам.

### 3.5 Каналы и интеграции
- Avito: авторизация, webhooks, сценарии автоответов, обновление объявлений.
- Telegram: бот, inline-клавиатуры, маршрутизация запросов.
- Сайт: интеграция чат-виджета, формы, калькулятор.
- amoCRM: создание лидов, обновление статусов, теги.
- Google Calendar: получение слотов, бронирование, отмена.
- ЮKassa: платёжные ссылки, обработка успешных/неуспешных платежей.
- Email SMTP: уведомления менеджерам и клиентам.

### 3.6 Безопасность и соответствие
- Реализация AES-256 шифрования PII.
- Валидация вебхуков (подписи Avito, Telegram, ЮKassa).
- Настройки CORS, политика логирования без персональных данных.
- Планы реагирования на инциденты и регламент эскалации.

## 4. Матрица ответственности (RACI)
| Направление | Ответственный (R) | Согласование (A) | Консультанты (C) | Информирование (I) |
|-------------|-------------------|------------------|------------------|--------------------|
| Архитектура и спецификация | Архитектор | Менеджер проекта | Аналитик | Команда |
| Backend разработка | Ведущий backend | Архитектор | DevOps, QA | Менеджер проекта |
| Интеграции (Avito, CRM, Calendar, ЮKassa) | Интегратор | Менеджер проекта | Backend, аналитик | Команда |
| RAG/LLM | ML-инженер | Архитектор | Backend | Менеджер проекта |
| Тестирование | QA-инженер | Менеджер проекта | Backend, интегратор | Команда |
| Документация и обучение | Аналитик | Менеджер проекта | Архитектор, QA | Все заинтересованные |
| DevOps и релизы | DevOps | Менеджер проекта | Backend, QA | Команда |

## 5. Контрольные точки и артефакты
- **T0**: утверждённая спецификация и план (этот документ).
- **T1**: готовность базовой платформы (API + авторизация + мониторинг).
- **T2**: запуск RAG/LLM и успешные диалоги на тестовых сценариях.
- **T3**: завершение интеграции Avito и Telegram, готовность калькулятора.
- **T4**: Генерация КП/договоров/счётов, проверка ограничений.
- **T5**: Интеграция CRM, календаря, платежей; подтверждённый E2E сценарий.
- **T6**: Нагрузочные тесты, аудит безопасности, подготовка релиза.
- **T7**: Запуск в прод, ретроспектива, план развития.

## 6. Риски и меры смягчения
- **Задержки интеграций внешних API**: ранний доступ, песочницы, мок-сервисы, буфер по срокам.
- **Нестабильность LLM или ограничения по стоимости**: кеширование результатов, fallback на альтернативного провайдера, оптимизация запросов.
- **Перегрузка команды**: распределение задач, привлечение дополнительных специалистов, приоритизация критических задач.
- **Несоответствие ожиданий бизнеса**: регулярные демо, согласование требований по KPI, обратная связь менеджеров продаж.
- **Безопасность и утечки данных**: аудит, тесты на проникновение, строгая политика доступа, шифрование.

## 7. План коммуникаций
- Еженедельный статус-митинг с ключевыми участниками.
- Ежедневные стендапы команды разработки.
- Канал в корпоративном мессенджере для оперативных вопросов.
- Отдельные митинги при интеграции каждого внешнего сервиса.
- Демо и ретроспектива по итогам каждой итерации.

## 8. Критерии готовности к релизу
- Остаток критических дефектов = 0, высоких дефектов ≤ 2 с планом исправления.
- Покрытие тестами ≥ 60%, автоматические тесты успешны.
- Документация (спецификация, план, инструкции по запуску) актуальна.
- Проведены нагрузочные и отказоустойчивые тесты, подтверждены KPI.
- Подготовлен план реагирования на инциденты и резервное копирование.

## 9. Дальнейшее развитие
- Оптимизация моделей и RAG (например, добавление reranker).
- Расширение каналов (WhatsApp, email, веб-чаты других площадок).
- Улучшение аналитики (дашборды, персональные рекомендации).
- Поддержка дополнительных языков и рынков.
- Автоматизация юридических процессов (оферта, акты).

---
Документ предназначен для управления развитием проекта и согласования действий между всеми участниками. Обновляется по мере прогресса и изменения требований.
